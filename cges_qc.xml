<?xml version="1.0"?>

<tool name="CGES-QC" id="cgesqc">
  <description>
  Quality summary pipeline for the consensus caller. The program takes four VCF files as inputs, and produces a variety of plots as output. The four input files refer to VCF files generated with Atlas, GATK Unified Genotyper, Freebayes, and a consensus set generated by CGES. The tool itself is written for easy integration with galaxy.
  </description>

  <command interpreter="python">
    python/qc.pipeline.py 
      --atlas-vcf $atlasVcf
      --gatk-vcf $gatkVcf
      --freebayes-vcf $freebayesVcf
      --cges-vcf $cgesVcf
      --temp-dir /scratch/galaxy/cox/tmp/
    #if str($pedfile):
      --ped-file $pedfile
    #else:
      none
    #end if
    #if str($):
      --ped-file $pedfile
    #else:
      none
    #end if
    #if str($tstvOut):
      --tstv-out $tstvOut
    #else:
      none
    #end if
    #if str($hetOut):
      --het-out $hetOut
    #else:
      none
    #end if
    #if str($mafOut):
      --maf-out $mafOut
    #else:
      none
    #end if
    #if str($missOut):
      --miss-out $missOut
    #else:
      none
    #end if
    #if str($mendelOut):
      --mendel-out $mendelOut
    #else:
      none
    #end if
  </command>

  <inputs>
    <param name="atlasVcf" type="data" format="vcf" label="Select a VCF file produced by Atlas-SNP2" help="A VCF file produced by Atlas-SNP2 (Required)"/>
    <param name="gatkVcf" type="data" format="vcf" label="Select a VCF file produced by GATK's Unified Genotyper" help="A VCF file produced by the GATK Unified Genotyper (Required)"/>
    <param name="freebayesVcf" type="data" format="vcf" label="Select a VCF file produced by Freebayes" help="A VCF file produced by Freebayes (Required)"/>
    <param name="cgessVcf" type="data" format="vcf" label="Select a VCF file produced by CGES consensus" help="A VCF file produced by CGES under consensus thresholds (Required)"/>
    <param name="pedfile" type="data" format="txt" label="Pedigree file" help="A text file specifying familial relationships among samples."/>
    <param name="tstvOut" type="data" format="txt" label="Pedigree file" help="A text file specifying familial relationships among samples."/>
  
    <param name="tstvOut" type="boolean" falsevalue="" truevalue="True" label="Output TsTv plot"/>
    <param name="hetOut" type="boolean" falsevalue="" truevalue="True" label="Output F statistic plot"/>
    <param name="mafOut" type="boolean" falsevalue="" truevalue="True" label="Output MAF plot"/>
    <param name="missOut" type="boolean" falsevalue="" truevalue="True" label="Output missingness plot"/>
    <param name="mendelOut" type="boolean" falsevalue="" truevalue="True" label="Output mendel plot"/>
    
  </inputs>

  <outputs>
    <data name="tstvOut" format="pdf" label="TsTv plot" >
      <filter>tstvOut == "True"</filter>
    </data>
    <data name="hetOut" format="pdf" label="F-statistic plot">
      <filter>hetOut == "True"</filter>
    </data>
    <data name="mafOut" format="pdf" label="MAF plot" >
      <filter>mafOut == "True"</filter>
    </data>
    <data name="missOut" format="pdf" label="Missingness plot" >
      <filter>missOut == "True"</filter>
    </data>
    <data name="mendelOut" format="pdf" label="Mendelian inconsistency plot" >
      <filter>mendelOut == "True"</filter>
    </data>
  </outputs>

  <help>
    Command Line Options:

    -h, --help            show this help message and exit
    --cges-vcf=CGES       File path for CGES VCF for which to generate QC
                          metrics.
    --atlas-vcf=ATLAS     File path for ATLAS VCF for which to generate QC metrics.
    --gatk-vcf=GATK       File path for GATK VCF for which to generate QC metrics.
    --freebayes-vcf=FREEBAYES
                                                                                            File path for Freebayes VCF for which to generate QC metrics.                                                               --ped-file=PEDFILE    Pedigree file for samples (Optional).                                               --tstv-out=TSTVOUT    Output file location for TsTv plots PDF.                                            --het-out=HETOUT      Output file location for heterozygosity plots PDF.                                  --maf-out=MAFOUT      Output file location for minor allele frequency plots PDF.
    --miss-out=MISSOUT    Output file location for missingess plots PDF.
    --rediscover-out=REDISCOVEROUT
                                                                                            Output file location for rediscovery rate plots PDF.
    --mendel-out=MENDELOUT
                                                                                            Output file location for Mendel inconsistency plots PDF.                                                                    --temp-dir=TEMPDIR    Directory for writing intermediate analysis files.
  </help>

</tool>



